<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>ECE 4160: Lab 6</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">
                <span class="d-block d-lg-none">Eshita Sangani</span>
                <span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="assets/profile.jpg" alt="..." /></span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html">About</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab1.html">Lab 1</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab2.html" >Lab 2</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab3.html" >Lab 2</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab4.html">Lab 4</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab5.html">Lab 4</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab6.html" style="color: rgb(31, 78, 47);">Lab 6</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab7.html">Lab 7</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab8.html">Lab 8</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab9.html">Lab 9</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab10.html">Lab 10</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab11.html">Lab 11</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab12.html">Lab 12</a></li>
                </ul>
            </div>
        </nav>
    <!-- Page Content-->
    <section class="resume-section" id="experience">
        <div class="resume-section-content">
            <h2 class="mb-2">Lab 6 <span class="text-primary">Closed Loop Control using PID</span></h2>
            <p class="mb-5">
                
                The purpose of this lab was to add closed loop control to the robot in the form of PID
                to get the robot to stop when it is within one foot of the wall.
                </p>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">PRELAB - Bluetooth</h3>
                
                    <p>
                        Before beginning this lab, I wanted to ensure that I was able to create a
                        debuggable system of sending data to be able to tune my PID values better.
                        I did this by executing PID control over a certain period of time and when 
                        it is executing, add the data to its associated arrays, and then send 
                        it over bluetooth once the task is done. 
                    </p>
                    <p> 
                       I chose to do Task A and wanted to use the front TOF sensor to send the data. 
                       Sending the data everytime that I received new data would be too slow so I 
                       stored the data first in the Artemis (in arrays) and then sending it 
                       over once the flag is set to be true and after 20 seconds
                       of data have been taken. 
                       After testing out how many data points I need to test Task A, 
                       I found out that an array size of 150 is ideal. I collect the time, 
                       the speed, and then the tof data on the Arduino side. When sent 
                       over bluetooth, I receive the data and process it using a notification
                       handler as in previous labs.
                    </p>

                    <p>
                        <script src="https://gist.github.com/eshitasangani/0886327db085d3fb4fce842809c17765.js"></script>
                    </p>

                    <p>
                        <script src="https://gist.github.com/eshitasangani/ad7be953d5003151cebd2a0f59f4c1fb.js"></script>
                    </p>
                </div>
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">PID Implementation</h3>
                    <p> 
                        Closed Loop Control is used because we wanted the system to be able 
                        to make its own adjustments -- the current output is sensed and compared
                        with the desired output and then the error between the two is used to adjust
                        the control input to the system. Using this error, the robot, in our  case,
                        can slowly move itself toward the desired state. This is implemented using PID
                        control. 
                    </p>

                    <p> 
                        PID stands for Proportional Integral Derivative and the controller is composed
                        of these terms which are summed together to form the control input. I chose to 
                        implement a P controller - it is proportional to the current error between 
                        the measured and desired error. This controller will take in the error signal 
                        and kp value as input. The Kp value wil calculate the speed of the robot 
                        proportionally based on the error between the current + target (which is 
                        detected based on the TOF sensor). This is seen in the code snippet below. 
                        I also added a limit speed section based on my results from Lab 5, to ensure 
                        that the robot would move even if it goes beyond the max/min speed limits.
                    </p>

                    <p>
                        <script src="https://gist.github.com/eshitasangani/4a320e648e9897cda820db742a6e4fa7.js"></script>
                    </p>

                    <!-- <iframe width="560" height="315" src="https://www.youtube.com/embed/4tZBuC5_Cpc"
                        title="YouTube video player" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe> -->

                </div>
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">Tuning PID</h3>
                    <p>
                        I started off with just a P controller so I could tune that value 
                        accordingly to understand how my robot reacted to the small changes 
                        and then wanted to add the I as well if there was time. My goal was 
                        to drive the robot towards a wall and then have it stop when 
                        it reaches 304 cm (1 ft) from the wall. I will do this using the 
                        TOF sensor readings
                        and then change my KP value based on the PWM output from the motors 
                        and also how it visually responds. 

                    </p>

                    <p>
                        I started off with a Kp value of 0.09 - just to see how my robot reacts 
                        to the PID control. This value was way too high and resulted in my robot 
                        shooting towards the wall and essentially crashing into the wall. It wasn't 
                        able to break quickly enough to prevent the giant overshoot which is what resulted
                        in the crash. Another reason that it could potentially overshoot is because 
                        I am only using the proportional value of the error and not the integral + derivative. 
                        
                        The next value I tried was 0.04 which was more reasonable but it still
                        had a slight movement backwards and wasn't able to get the distance correctly on 
                        the first try. I then tried 0.01, which ended up being too little, and the robot
                        didn't even move since it didn't have enough drive to do so. After trying these 
                         values, I picked 0.035 which ended up being the most ideal combination and stopped 
                         almost exactly one foot from the wall. 
                    </p>

                    <p>
                        Something that also affected my KP value was the surface that I was practicing on. 
                        When I tried it on carpeted surfaces, it ended up working better with higher Kp values
                        in comparison to the floors in Upson + Philips. I ended up using the floors in Upson 
                        for my PID control.  
                    </p>

                </div>
            </div>


            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">Demonstration of PID</h3>
                   
                    <p>
                        PID w KP = 0.035

                    </p>
                    <video width="500" controls>
                        <source src="assets/pidworking.mp4" type=video/mp4>
                    </video>

                    <p>
                        I also plotted the TOF vs Time + PWM vs Time for the most ideal run which
                        was when the Kp value was 0.035. 
                    </p>

                    <p> 
                        <img src="assets/toftime.jpg" alt="..." width="55%" />
                    </p>

                    <p> 
                        <img src="assets/pwmtime.jpg" alt="..." width="55%" />
                    </p>
                    
                    <p>
                        PID w KP = 0.09
                        The PID value is too big and it overshoots.
                    </p>

                    <video width="500" controls>
                        <source src="assets/pidovershoot.mp4" type=video/mp4>
                    </video>

                    <p>
                        I also plotted the TOF vs Time + PWM vs Time for the overshoot run which
                        was when the Kp value was 0.09. In this graphs, the oscillation is visible
                        and it kinda goes all over the place.
                    </p>

                    <p> 
                        <img src="assets/1.jpg" alt="..." width="55%" />
                    </p>

                    <p> 
                        <img src="assets/2.jpg" alt="..." width="55%" />
                    </p>

                    <p>
                        PID w KP = 0.01
                        The PID value is too small and it doesn't move. 
                    </p>


                    <video width="500" controls>
                        <source src="assets/notwork.mp4" type=video/mp4>
                    </video>


                </div>
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">Range + Sampling Time</h3>
                
                    <p>
                        Before conducting this PID lab, I made sure in the prelab to avoid 
                        delays without sending data while the PID control is executing and
                        removing any print statements for debugging. Regardless of this, 
                        each iteration of the loop takes around 0.09 seconds, meaning
                        the sampling frequency is 15 samples per second. 

                    </p>


                </div>
            </div>



        </div>
    </section>

    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>