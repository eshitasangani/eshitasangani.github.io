<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>ECE 4160: Lab 7</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">
                <span class="d-block d-lg-none">Eshita Sangani</span>
                <span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="assets/profile.jpg" alt="..." /></span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html">About</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab1.html">Lab 1</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab2.html" >Lab 2</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab3.html" >Lab 2</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab4.html">Lab 4</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab5.html">Lab 4</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab6.html">Lab 6</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab7.html" style="color: rgb(31, 78, 47);">Lab 7</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab8.html">Lab 8</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab9.html">Lab 9</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab10.html">Lab 10</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab11.html">Lab 11</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab12.html">Lab 12</a></li>
                </ul>
            </div>
        </nav>
    <!-- Page Content-->
    <section class="resume-section" id="experience">
        <div class="resume-section-content">
            <h2 class="mb-2">Lab 7 <span class="text-primary">Kalman Filter</span></h2>
            <p class="mb-5">
                
                The purpose of this lab was to use the Kalman filter to speed up the behavior
                that was executed in Lab 6 as well as make it more accurate.
                The Kalman filter uses the TOF sensor readings 
                to make a more precise position estimate based on the pwm input as well. 
                </p>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">DRAG + MOMEMTUM ESTIMATE</h3>
                    
                    <p>
                        Before creating a Kalman filter, I wanted to create a state space
                        model for my robot based on the lecture in class. I used a step 
                        response to be able to measure the TOF + PWM data as the robot moved.
                        I then plotted these graphs below. 
                    </p>
                    <p> 
                        <img src="assets/tof_3000.jpg" alt="..." width="55%" />
                    </p>
                    <p> 
                        <img src="assets/pwm_3000.jpg" alt="..." width="55%" />
                    </p>

                    <p> 
                        <img src="assets/vel_3000.jpg" alt="..." width="55%" />
                    </p>

                    <p> 
                        To find the values of drag and momentum, I used the A matrix that 
                        was discussed in lecture and the equations for d and m. 
                    </p>
                    <p> 
                        d = u / ẋ
                    </p>
                    <p> 
                        m = -dt / ln (1 - 0.9)
                    </p>

                    <p> 
                        From the graphs plotted above, I can determine the steady 
                        state velocity, which is defined as the peak velocity that
                        the robot stops acceleratingw hen ran at the max PWM value 
                        that is defined from lab 6. The 90% rise time is the 
                        time that it takes to reach 90% of the steady state velocity 
                        found above.
                    </p>
                    <p> 
                        ẋ = 1900 m/s 
                    </p>
                    <p> 
                        t(0.9)= 1.25 s
                    </p>

                    <p> 
                        Now, from these values I can caluclate the drag and mass values
                        from the equations specified above. 
                    </p>
                    <p> 
                        d = 1 / 1900 = 0.00053
                    </p>
                    <p> 
                        m = -0.00053 * 1.25 / ln(1-0.9) = 0.00029
                    </p>
        
                    <p> 
                        After calculating the values for drag and momentum, I then plugged 
                        them into the A and B matrices from the Kalman filter equations. 
                    </p>
                    <p> 
                        <img src="assets/A.jpg" alt="..." width="55%" />
                    </p>
                    <p> 
                        <img src="assets/B.jpg" alt="..." width="55%" />
                    </p>

                </div>
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">INITIALIZE KALMAN FILTER</h3>
                    <p> 
                       From the first part, I had already measured my robot's step response 
                       and then just continued to use that data to then be able to initialize 
                       the Kalman filter. Now for the actual implementation: 
                    </p>

                    <p> 
                        I first discretized the A and B matrices based on my calculated sampling rate. 
                        The sampling rate was calculating by finding the difference on average of 
                        the TOF data. This gave me a sampling rate of 0.074 s. I used this as my Δt value. 
                    </p>

                    <p> 
                        For my C matrix, I used the one from class: [[-1, 0]] 
                        since we only used the TOF data and we measured negative 
                        distance. For the state vector, I initialized it 
                        with the initial distance from the wall and 
                        set the velocity to be 0 as it was stationary.

                    </p>
                    <p> 
                        <img src="assets/other.jpg" alt="..." width="55%" />
                    </p>

                    <p> 
                        After calculating these respective values + matrices, 
                        I implemented this initialization in python using the code snippet
                        below. 
                    </p>

                    <p>
                        <script src="https://gist.github.com/eshitasangani/0fb6e01fdb170c9c9db835b30ef0b299.js"></script>
                    </p>
                </div>
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">KALMAN IN PYTHON</h3>
                    <p>
                        I then needed to actually check if the Kalman filter could work 
                        based on the parameters I calculated and the earlier run talked about 
                        above. This code snippet is shown below. 
                    </p>
                    <p>
                        <script src="https://gist.github.com/eshitasangani/19ca28237de5b1ab323806beb4bf386d.js"></script>
                    </p>
                    <p>
                        Running KF on the parameters calculated gave this plot. The KF filtered was 
                        pretty accurate with most of the points being the same, but I still 
                        wanted to mess around with the values to see if I could get it even more 
                        accurate.
                    </p>
                    <p> 
                        <img src="assets/kf1.jpg" alt="..." width="55%" />
                    </p>
                    <p>
                        I didn't change my values for sig1 and sig2 - I instead adjusted sig3 
                        so that the sensor data would be less used and it would focus more on the model 
                        making the plot more accurate. 
                    </p>
                    <p> 
                        <img src="assets/kf2.jpg" alt="..." width="55%" />
                    </p>

                    <p>
                        Now, I also wanted to see how much the sig values would have to change
                        to introduce a lot of uncertainty to the model. Changing sig1 and sig2 
                        did not really affect the plot that much so instead I made sig3 150 
                        and saw the drastic effect away from the raw data. 
                    </p>
                    <p> 
                        <img src="assets/kf3.jpg" alt="..." width="55%" />
                    </p>

                </div>
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                <div class="flex-grow-1">
                    <h3 class="mb-0">KF ON ROBOT</h3>
                    <p>
                        Eventually, I wanted to implement the same task as lab 6 using 
                        the kalman filter with the calculated parameters from above.  
                     </p>
                   
                    <p>
                       After figuring out the best possible parameters -- ended up 
                       deciding sig1 = sig2 = 36.76 and sig3 = 10 -- I implemented 
                       the KF on the robot. I was pretty confused on how to get 
                       matrices and all the necessary computation 
                    </p>

                    <p>
                        <script src="https://gist.github.com/eshitasangani/bed48aff047de0d1d7aafff3341e6ebd.js"></script>
                    </p>

                    <video width="500" controls>
                        <source src="assets/kf.mp4" type=video/mp4>
                    </video>

                   

                </div>
            </div>

        </div>
    </section>

    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>